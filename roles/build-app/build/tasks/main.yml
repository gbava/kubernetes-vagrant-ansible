---

- name: Create directory for the app sources
  file:
    path: "{{ kubernetes_dir }}/src"
    state: directory

- name: Create build directory
  file:
    path: "{{ kubernetes_dir }}/build"
    state: directory

- name: Install build tools
  yum: name={{ item }} state=installed
  become: yes
  with_items:
  - git
  - java-1.8.0-openjdk-devel

- name: Clone Spring Boot repository
  git:
    repo: https://github.com/spring-projects/spring-boot.git
    dest: "{{ kubernetes_dir }}/src/spring-boot"

- name: Source
  shell: source /etc/profile.d/maven_home.sh

- name: Build jar file with Maven
  shell: mvn package
  args:
    chdir: "{{ kubernetes_dir }}/src/spring-boot/spring-boot-samples/spring-boot-sample-hateoas"

# fixme: app version to variable
- name: copy jar file to build dir
  synchronize:
    src: "{{ kubernetes_dir }}/src/spring-boot/spring-boot-samples/spring-boot-sample-hateoas/target/spring-boot-sample-hateoas-2.0.1.BUILD-SNAPSHOT.jar"
    dest: "{{ kubernetes_dir }}/build/"
  delegate_to: "{{ groups['master'][0] }}"